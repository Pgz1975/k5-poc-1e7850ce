{
  "dashboards": [
    {
      "id": "k5-overview",
      "uid": "k5-overview",
      "title": "K5 POC - System Overview",
      "description": "High-level overview of K5 system health and performance",
      "tags": ["k5", "overview", "system"],
      "timezone": "browser",
      "schemaVersion": 38,
      "version": 1,
      "panels": [
        {
          "id": 1,
          "title": "System Health Status",
          "type": "stat",
          "gridPos": { "x": 0, "y": 0, "w": 6, "h": 4 },
          "targets": [
            {
              "expr": "k5_service_health_status",
              "legendFormat": "{{service}}",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  { "color": "red", "value": 0 },
                  { "color": "green", "value": 1 }
                ]
              },
              "mappings": [
                { "type": "value", "value": "0", "text": "Unhealthy" },
                { "type": "value", "value": "1", "text": "Healthy" }
              ]
            }
          }
        },
        {
          "id": 2,
          "title": "API Request Rate",
          "type": "graph",
          "gridPos": { "x": 6, "y": 0, "w": 6, "h": 4 },
          "targets": [
            {
              "expr": "rate(k5_api_requests_total[5m])",
              "legendFormat": "{{method}} {{endpoint}}",
              "refId": "A"
            }
          ]
        },
        {
          "id": 3,
          "title": "API Latency (p95)",
          "type": "graph",
          "gridPos": { "x": 12, "y": 0, "w": 6, "h": 4 },
          "targets": [
            {
              "expr": "histogram_quantile(0.95, rate(k5_api_request_duration_seconds_bucket[5m]))",
              "legendFormat": "{{endpoint}}",
              "refId": "A"
            }
          ]
        },
        {
          "id": 4,
          "title": "Active Alerts",
          "type": "stat",
          "gridPos": { "x": 18, "y": 0, "w": 6, "h": 4 },
          "targets": [
            {
              "expr": "k5_alerts_active",
              "legendFormat": "{{severity}}",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  { "color": "green", "value": 0 },
                  { "color": "yellow", "value": 1 },
                  { "color": "red", "value": 5 }
                ]
              }
            }
          }
        },
        {
          "id": 5,
          "title": "CPU Usage",
          "type": "graph",
          "gridPos": { "x": 0, "y": 4, "w": 8, "h": 4 },
          "targets": [
            {
              "expr": "k5_cpu_usage_percent",
              "legendFormat": "{{service}}",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  { "color": "green", "value": 0 },
                  { "color": "yellow", "value": 70 },
                  { "color": "red", "value": 90 }
                ]
              }
            }
          }
        },
        {
          "id": 6,
          "title": "Memory Usage",
          "type": "graph",
          "gridPos": { "x": 8, "y": 4, "w": 8, "h": 4 },
          "targets": [
            {
              "expr": "k5_memory_usage_bytes",
              "legendFormat": "{{service}} - {{type}}",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "bytes"
            }
          }
        },
        {
          "id": 7,
          "title": "Error Rate",
          "type": "graph",
          "gridPos": { "x": 16, "y": 4, "w": 8, "h": 4 },
          "targets": [
            {
              "expr": "rate(k5_api_errors_total[5m])",
              "legendFormat": "{{error_type}}",
              "refId": "A"
            }
          ]
        }
      ]
    },
    {
      "id": "k5-pdf-processing",
      "uid": "k5-pdf-processing",
      "title": "K5 POC - PDF Processing",
      "description": "PDF processing pipeline metrics and quality monitoring",
      "tags": ["k5", "pdf", "processing"],
      "panels": [
        {
          "id": 1,
          "title": "PDFs Processed (Total)",
          "type": "stat",
          "gridPos": { "x": 0, "y": 0, "w": 6, "h": 3 },
          "targets": [
            {
              "expr": "sum(k5_pdf_processed_total)",
              "refId": "A"
            }
          ]
        },
        {
          "id": 2,
          "title": "Processing Rate",
          "type": "graph",
          "gridPos": { "x": 6, "y": 0, "w": 9, "h": 6 },
          "targets": [
            {
              "expr": "rate(k5_pdf_processed_total[5m])",
              "legendFormat": "{{status}} - {{grade_level}}",
              "refId": "A"
            }
          ]
        },
        {
          "id": 3,
          "title": "Queue Size",
          "type": "gauge",
          "gridPos": { "x": 15, "y": 0, "w": 9, "h": 6 },
          "targets": [
            {
              "expr": "k5_pdf_queue_size",
              "legendFormat": "{{priority}}",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  { "color": "green", "value": 0 },
                  { "color": "yellow", "value": 50 },
                  { "color": "red", "value": 100 }
                ]
              }
            }
          }
        },
        {
          "id": 4,
          "title": "Processing Duration (p95)",
          "type": "graph",
          "gridPos": { "x": 0, "y": 6, "w": 12, "h": 6 },
          "targets": [
            {
              "expr": "histogram_quantile(0.95, rate(k5_pdf_processing_duration_seconds_bucket[5m]))",
              "legendFormat": "{{grade_level}}",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "s"
            }
          }
        },
        {
          "id": 5,
          "title": "Processing Errors",
          "type": "table",
          "gridPos": { "x": 12, "y": 6, "w": 12, "h": 6 },
          "targets": [
            {
              "expr": "topk(10, rate(k5_pdf_processing_errors_total[1h]))",
              "legendFormat": "{{error_type}} - {{stage}}",
              "refId": "A",
              "format": "table"
            }
          ]
        },
        {
          "id": 6,
          "title": "Content Quality Scores",
          "type": "graph",
          "gridPos": { "x": 0, "y": 12, "w": 12, "h": 6 },
          "targets": [
            {
              "expr": "k5_content_readability_score",
              "legendFormat": "Readability - {{grade_level}}",
              "refId": "A"
            },
            {
              "expr": "k5_content_accuracy_score",
              "legendFormat": "Accuracy - {{grade_level}}",
              "refId": "B"
            }
          ]
        },
        {
          "id": 7,
          "title": "Pages Processed by Grade",
          "type": "piechart",
          "gridPos": { "x": 12, "y": 12, "w": 12, "h": 6 },
          "targets": [
            {
              "expr": "sum by (grade_level) (k5_pdf_pages_processed_total)",
              "legendFormat": "{{grade_level}}",
              "refId": "A"
            }
          ]
        }
      ]
    },
    {
      "id": "k5-llm-usage",
      "uid": "k5-llm-usage",
      "title": "K5 POC - LLM Usage & Costs",
      "description": "LLM API usage, performance, and cost tracking",
      "tags": ["k5", "llm", "ai", "cost"],
      "panels": [
        {
          "id": 1,
          "title": "LLM Requests",
          "type": "graph",
          "gridPos": { "x": 0, "y": 0, "w": 12, "h": 6 },
          "targets": [
            {
              "expr": "rate(k5_llm_requests_total[5m])",
              "legendFormat": "{{model}} - {{operation}}",
              "refId": "A"
            }
          ]
        },
        {
          "id": 2,
          "title": "Token Usage",
          "type": "graph",
          "gridPos": { "x": 12, "y": 0, "w": 12, "h": 6 },
          "targets": [
            {
              "expr": "rate(k5_llm_tokens_total[5m])",
              "legendFormat": "{{model}} - {{type}}",
              "refId": "A"
            }
          ]
        },
        {
          "id": 3,
          "title": "LLM Latency (p95)",
          "type": "graph",
          "gridPos": { "x": 0, "y": 6, "w": 12, "h": 6 },
          "targets": [
            {
              "expr": "histogram_quantile(0.95, rate(k5_llm_request_duration_seconds_bucket[5m]))",
              "legendFormat": "{{model}}",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "s"
            }
          }
        },
        {
          "id": 4,
          "title": "LLM Costs (Hourly)",
          "type": "graph",
          "gridPos": { "x": 12, "y": 6, "w": 12, "h": 6 },
          "targets": [
            {
              "expr": "increase(k5_llm_token_cost_dollars[1h])",
              "legendFormat": "{{model}}",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "currencyUSD"
            }
          }
        },
        {
          "id": 5,
          "title": "Rate Limit Hits",
          "type": "stat",
          "gridPos": { "x": 0, "y": 12, "w": 12, "h": 4 },
          "targets": [
            {
              "expr": "sum(k5_llm_rate_limit_hits_total)",
              "refId": "A"
            }
          ]
        },
        {
          "id": 6,
          "title": "Total LLM Cost (24h)",
          "type": "stat",
          "gridPos": { "x": 12, "y": 12, "w": 12, "h": 4 },
          "targets": [
            {
              "expr": "sum(increase(k5_llm_token_cost_dollars[24h]))",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "currencyUSD",
              "decimals": 2
            }
          }
        }
      ]
    },
    {
      "id": "k5-database",
      "uid": "k5-database",
      "title": "K5 POC - Database Performance",
      "description": "Database query performance and connection pool metrics",
      "tags": ["k5", "database", "performance"],
      "panels": [
        {
          "id": 1,
          "title": "Query Rate",
          "type": "graph",
          "gridPos": { "x": 0, "y": 0, "w": 12, "h": 6 },
          "targets": [
            {
              "expr": "rate(k5_db_queries_total[5m])",
              "legendFormat": "{{operation}} - {{table}}",
              "refId": "A"
            }
          ]
        },
        {
          "id": 2,
          "title": "Query Duration (p95)",
          "type": "graph",
          "gridPos": { "x": 12, "y": 0, "w": 12, "h": 6 },
          "targets": [
            {
              "expr": "histogram_quantile(0.95, rate(k5_db_query_duration_seconds_bucket[5m]))",
              "legendFormat": "{{operation}} - {{table}}",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "s"
            }
          }
        },
        {
          "id": 3,
          "title": "Connection Pool",
          "type": "graph",
          "gridPos": { "x": 0, "y": 6, "w": 12, "h": 6 },
          "targets": [
            {
              "expr": "k5_db_connections_active",
              "legendFormat": "Active - {{pool}}",
              "refId": "A"
            },
            {
              "expr": "k5_db_connections_idle",
              "legendFormat": "Idle - {{pool}}",
              "refId": "B"
            }
          ]
        },
        {
          "id": 4,
          "title": "Connection Errors",
          "type": "table",
          "gridPos": { "x": 12, "y": 6, "w": 12, "h": 6 },
          "targets": [
            {
              "expr": "topk(10, rate(k5_db_connection_errors_total[1h]))",
              "legendFormat": "{{error_type}}",
              "refId": "A",
              "format": "table"
            }
          ]
        }
      ]
    },
    {
      "id": "k5-cache",
      "uid": "k5-cache",
      "title": "K5 POC - Cache Performance",
      "description": "Cache hit rates, size, and performance metrics",
      "tags": ["k5", "cache", "performance"],
      "panels": [
        {
          "id": 1,
          "title": "Cache Hit Rate",
          "type": "gauge",
          "gridPos": { "x": 0, "y": 0, "w": 8, "h": 6 },
          "targets": [
            {
              "expr": "sum(rate(k5_cache_hits_total[5m])) / sum(rate(k5_cache_operations_total[5m]))",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "percentunit",
              "min": 0,
              "max": 1,
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  { "color": "red", "value": 0 },
                  { "color": "yellow", "value": 0.7 },
                  { "color": "green", "value": 0.9 }
                ]
              }
            }
          }
        },
        {
          "id": 2,
          "title": "Cache Operations",
          "type": "graph",
          "gridPos": { "x": 8, "y": 0, "w": 16, "h": 6 },
          "targets": [
            {
              "expr": "rate(k5_cache_hits_total[5m])",
              "legendFormat": "Hits - {{cache_type}}",
              "refId": "A"
            },
            {
              "expr": "rate(k5_cache_misses_total[5m])",
              "legendFormat": "Misses - {{cache_type}}",
              "refId": "B"
            }
          ]
        },
        {
          "id": 3,
          "title": "Cache Size",
          "type": "graph",
          "gridPos": { "x": 0, "y": 6, "w": 12, "h": 6 },
          "targets": [
            {
              "expr": "k5_cache_size_bytes",
              "legendFormat": "{{cache_type}}",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "bytes"
            }
          }
        },
        {
          "id": 4,
          "title": "Cache Evictions",
          "type": "graph",
          "gridPos": { "x": 12, "y": 6, "w": 12, "h": 6 },
          "targets": [
            {
              "expr": "rate(k5_cache_evictions_total[5m])",
              "legendFormat": "{{cache_type}} - {{reason}}",
              "refId": "A"
            }
          ]
        }
      ]
    },
    {
      "id": "k5-user-activity",
      "uid": "k5-user-activity",
      "title": "K5 POC - User Activity (COPPA Compliant)",
      "description": "Anonymized user engagement and activity metrics",
      "tags": ["k5", "users", "engagement", "coppa"],
      "panels": [
        {
          "id": 1,
          "title": "Active Users",
          "type": "stat",
          "gridPos": { "x": 0, "y": 0, "w": 8, "h": 4 },
          "targets": [
            {
              "expr": "sum(k5_active_users)",
              "refId": "A"
            }
          ]
        },
        {
          "id": 2,
          "title": "Sessions by Age Range",
          "type": "graph",
          "gridPos": { "x": 8, "y": 0, "w": 16, "h": 6 },
          "targets": [
            {
              "expr": "rate(k5_user_sessions_total[5m])",
              "legendFormat": "{{age_range}} - {{consent_type}}",
              "refId": "A"
            }
          ]
        },
        {
          "id": 3,
          "title": "Session Duration (Median)",
          "type": "graph",
          "gridPos": { "x": 0, "y": 4, "w": 12, "h": 6 },
          "targets": [
            {
              "expr": "histogram_quantile(0.5, rate(k5_user_session_duration_seconds_bucket[5m]))",
              "legendFormat": "{{age_range}}",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "s"
            }
          }
        },
        {
          "id": 4,
          "title": "User Interactions",
          "type": "graph",
          "gridPos": { "x": 12, "y": 4, "w": 12, "h": 6 },
          "targets": [
            {
              "expr": "rate(k5_user_interactions_total[5m])",
              "legendFormat": "{{feature}} - {{age_range}}",
              "refId": "A"
            }
          ]
        },
        {
          "id": 5,
          "title": "Content Views by Grade",
          "type": "piechart",
          "gridPos": { "x": 0, "y": 10, "w": 12, "h": 6 },
          "targets": [
            {
              "expr": "sum by (grade_level) (rate(k5_content_views_total[1h]))",
              "legendFormat": "{{grade_level}}",
              "refId": "A"
            }
          ]
        },
        {
          "id": 6,
          "title": "Engagement Score",
          "type": "gauge",
          "gridPos": { "x": 12, "y": 10, "w": 12, "h": 6 },
          "targets": [
            {
              "expr": "avg(k5_engagement_score)",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "min": 0,
              "max": 100,
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  { "color": "red", "value": 0 },
                  { "color": "yellow", "value": 50 },
                  { "color": "green", "value": 75 }
                ]
              }
            }
          }
        }
      ]
    }
  ]
}
